# ç™¾æœå›­èˆ†æƒ…ç›‘æµ‹ç³»ç»Ÿ - äº‘ç«¯éƒ¨ç½²æ‰‹å†Œ

## æœåŠ¡å™¨ä¿¡æ¯
- **å…¬ç½‘IP**: 101.201.214.42
- **ç”¨æˆ·å**: root
- **å¯†ç **: qwer.123
- **è®¿é—®ç«¯å£**: 5000

---

## å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

å¦‚æœä½ çš„ç”µè„‘å·²å®‰è£… `sshpass`ï¼Œç›´æ¥è¿è¡Œï¼š

```bash
cd /Users/xiaoyan/Desktop/èˆ†æƒ…/BettaFish-test
./äº‘ç«¯éƒ¨ç½².sh
```

**å®‰è£… sshpassï¼š**
- macOS: `brew install hudochenkov/sshpass/sshpass`
- Ubuntu: `sudo apt-get install sshpass`

---

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²ï¼ˆä¸éœ€è¦sshpassï¼‰

#### ç¬¬1æ­¥ï¼šç™»å½•æœåŠ¡å™¨

æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š

```bash
ssh root@101.201.214.42
# è¾“å…¥å¯†ç ï¼šqwer.123
```

#### ç¬¬2æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šå‡†å¤‡ç¯å¢ƒ

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /root/baiguoyuan
cd /root/baiguoyuan

# æ£€æŸ¥Pythonç‰ˆæœ¬ï¼ˆéœ€è¦3.8+ï¼‰
python3 --version

# å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
python3 -m pip install --user virtualenv
```

#### ç¬¬3æ­¥ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶

**åœ¨æœ¬åœ°ç”µè„‘æ–°å¼€ä¸€ä¸ªç»ˆç«¯**ï¼Œæ‰§è¡Œï¼š

```bash
cd /Users/xiaoyan/Desktop/èˆ†æƒ…/BettaFish-test

# æ‰“åŒ…é¡¹ç›®
tar czf baiguoyuan.tar.gz \
    --exclude='venv' \
    --exclude='__pycache__' \
    --exclude='*.pyc' \
    --exclude='.git' \
    --exclude='logs' \
    --exclude='*.log' \
    .

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp baiguoyuan.tar.gz root@101.201.214.42:/root/baiguoyuan/
# è¾“å…¥å¯†ç ï¼šqwer.123
```

#### ç¬¬4æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šè§£å‹å¹¶å®‰è£…

å›åˆ°**æœåŠ¡å™¨SSHç»ˆç«¯**ï¼š

```bash
cd /root/baiguoyuan

# è§£å‹æ–‡ä»¶
tar xzf baiguoyuan.tar.gz
rm baiguoyuan.tar.gz

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å®‰è£…ä¾èµ–ï¼ˆè¿™éœ€è¦å‡ åˆ†é’Ÿï¼‰
pip install --upgrade pip
pip install streamlit pandas openai schedule requests beautifulsoup4 selenium
```

#### ç¬¬5æ­¥ï¼šé…ç½®é˜²ç«å¢™

```bash
# æ£€æŸ¥ç³»ç»Ÿç±»å‹
if command -v firewall-cmd &> /dev/null; then
    # CentOS/RHEL
    firewall-cmd --permanent --add-port=5000/tcp
    firewall-cmd --reload
    echo "é˜²ç«å¢™å·²é…ç½®"
elif command -v ufw &> /dev/null; then
    # Ubuntu
    ufw allow 5000/tcp
    echo "é˜²ç«å¢™å·²é…ç½®"
else
    echo "è¯·æ‰‹åŠ¨åœ¨äº‘æœåŠ¡å•†æ§åˆ¶å°å¼€æ”¾5000ç«¯å£"
fi
```

**é‡è¦ï¼šåœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é…ç½®å®‰å…¨ç»„**
1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. æ‰¾åˆ°ä½ çš„ECSå®ä¾‹
3. ç‚¹å‡»"å®‰å…¨ç»„" â†’ "é…ç½®è§„åˆ™"
4. æ·»åŠ å…¥æ–¹å‘è§„åˆ™ï¼šç«¯å£ 5000ï¼Œåè®® TCPï¼Œæˆæƒå¯¹è±¡ 0.0.0.0/0

#### ç¬¬6æ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
cd /root/baiguoyuan
source venv/bin/activate

# åå°å¯åŠ¨æœåŠ¡
nohup streamlit run baiguoyuan_review_app.py \
    --server.port 5000 \
    --server.address 0.0.0.0 \
    --server.headless true \
    > app.log 2>&1 &

# è®°å½•è¿›ç¨‹ID
echo $! > app.pid

echo "æœåŠ¡å·²å¯åŠ¨ï¼"
echo "è®¿é—®åœ°å€: http://101.201.214.42:5000"
```

#### ç¬¬7æ­¥ï¼šéªŒè¯æœåŠ¡

```bash
# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep streamlit

# æŸ¥çœ‹æ—¥å¿—
tail -f app.log

# æµ‹è¯•è®¿é—®ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šï¼‰
curl http://localhost:5000
```

---

## æœåŠ¡ç®¡ç†å‘½ä»¤

### åœæ­¢æœåŠ¡
```bash
# ä½¿ç”¨PIDæ–‡ä»¶åœæ­¢
if [ -f /root/baiguoyuan/app.pid ]; then
    kill $(cat /root/baiguoyuan/app.pid)
    rm /root/baiguoyuan/app.pid
fi

# æˆ–è€…å¼ºåˆ¶åœæ­¢
pkill -f "streamlit run baiguoyuan_review_app.py"
```

### é‡å¯æœåŠ¡
```bash
# å…ˆåœæ­¢
pkill -f "streamlit run baiguoyuan_review_app.py"

# å†å¯åŠ¨
cd /root/baiguoyuan
source venv/bin/activate
nohup streamlit run baiguoyuan_review_app.py \
    --server.port 5000 \
    --server.address 0.0.0.0 \
    --server.headless true \
    > app.log 2>&1 &
echo $! > app.pid
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹
tail -f /root/baiguoyuan/app.log

# æŸ¥çœ‹æœ€å50è¡Œ
tail -n 50 /root/baiguoyuan/app.log

# æŸ¥çœ‹é”™è¯¯
grep -i error /root/baiguoyuan/app.log
```

### æ›´æ–°ä»£ç 
```bash
# åœ¨æœ¬åœ°æ‰“åŒ…æ–°ä»£ç 
cd /Users/xiaoyan/Desktop/èˆ†æƒ…/BettaFish-test
tar czf baiguoyuan.tar.gz --exclude='venv' --exclude='__pycache__' .
scp baiguoyuan.tar.gz root@101.201.214.42:/root/baiguoyuan/

# åœ¨æœåŠ¡å™¨ä¸Š
cd /root/baiguoyuan
pkill -f streamlit  # åœæ­¢æœåŠ¡
tar xzf baiguoyuan.tar.gz  # è§£å‹æ–°ä»£ç 
rm baiguoyuan.tar.gz
source venv/bin/activate
# é‡æ–°å¯åŠ¨...
```

---

## é…ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼ˆå¯é€‰ï¼‰

åˆ›å»º systemd æœåŠ¡ï¼š

```bash
cat > /etc/systemd/system/baiguoyuan.service << 'EOF'
[Unit]
Description=ç™¾æœå›­èˆ†æƒ…ç›‘æµ‹ç³»ç»Ÿ
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/baiguoyuan
Environment="PATH=/root/baiguoyuan/venv/bin"
ExecStart=/root/baiguoyuan/venv/bin/streamlit run baiguoyuan_review_app.py --server.port 5000 --server.address 0.0.0.0 --server.headless true
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# é‡è½½systemd
systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
systemctl start baiguoyuan

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable baiguoyuan

# æŸ¥çœ‹çŠ¶æ€
systemctl status baiguoyuan
```

**systemd ç®¡ç†å‘½ä»¤ï¼š**
```bash
systemctl start baiguoyuan    # å¯åŠ¨
systemctl stop baiguoyuan     # åœæ­¢
systemctl restart baiguoyuan  # é‡å¯
systemctl status baiguoyuan   # çŠ¶æ€
journalctl -u baiguoyuan -f   # æŸ¥çœ‹æ—¥å¿—
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ— æ³•è®¿é—® http://101.201.214.42:5000

**æ£€æŸ¥æ¸…å•ï¼š**
1. æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`ps aux | grep streamlit`
2. ç«¯å£æ˜¯å¦ç›‘å¬ï¼š`netstat -tlnp | grep 5000` æˆ– `ss -tlnp | grep 5000`
3. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ï¼šæ£€æŸ¥ä¸Šé¢çš„é˜²ç«å¢™é…ç½®
4. é˜¿é‡Œäº‘å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾5000ç«¯å£ï¼ˆæœ€å¸¸è§é—®é¢˜ï¼‰
5. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š`tail -f /root/baiguoyuan/app.log`

### é—®é¢˜2ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
cd /root/baiguoyuan
source venv/bin/activate
streamlit run baiguoyuan_review_app.py --server.port 5000
# ä¸åŠ  nohupï¼Œç›´æ¥æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
```

### é—®é¢˜3ï¼šä¾èµ–å®‰è£…å¤±è´¥

```bash
# æ›´æ–°pip
pip install --upgrade pip

# é€ä¸ªå®‰è£…ä¾èµ–
pip install streamlit
pip install pandas
pip install openai
pip install schedule
pip install requests
pip install beautifulsoup4
pip install selenium
```

### é—®é¢˜4ï¼šç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨5000ç«¯å£çš„è¿›ç¨‹
lsof -i :5000
# æˆ–
netstat -tlnp | grep 5000

# æ€æ‰è¿›ç¨‹
kill -9 <PID>
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨Nginxåå‘ä»£ç†**ï¼ˆå¯é€‰ï¼‰
   - é…ç½®åŸŸåè®¿é—®
   - å¯ç”¨HTTPS
   - è´Ÿè½½å‡è¡¡

2. **å®šæœŸæ¸…ç†æ—¥å¿—**
   ```bash
   # æ·»åŠ åˆ°crontab
   0 0 * * * truncate -s 0 /root/baiguoyuan/app.log
   ```

3. **ç›‘æ§æœåŠ¡çŠ¶æ€**
   ```bash
   # ç®€å•çš„ç›‘æ§è„šæœ¬
   cat > /root/check_service.sh << 'EOF'
   #!/bin/bash
   if ! pgrep -f "streamlit run baiguoyuan_review_app.py" > /dev/null; then
       cd /root/baiguoyuan
       source venv/bin/activate
       nohup streamlit run baiguoyuan_review_app.py --server.port 5000 --server.address 0.0.0.0 --server.headless true > app.log 2>&1 &
   fi
   EOF
   chmod +x /root/check_service.sh

   # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼ˆæ·»åŠ åˆ°crontabï¼‰
   */5 * * * * /root/check_service.sh
   ```

---

## è®¿é—®åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

ğŸŒ **http://101.201.214.42:5000**

---

## è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥æ—¥å¿—ï¼š`tail -f /root/baiguoyuan/app.log`
2. æŸ¥çœ‹è¿›ç¨‹ï¼š`ps aux | grep streamlit`
3. æ£€æŸ¥ç«¯å£ï¼š`netstat -tlnp | grep 5000`
4. ä¿å­˜é”™è¯¯ä¿¡æ¯ä»¥ä¾¿æ’æŸ¥

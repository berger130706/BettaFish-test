# 百果园舆情监测系统 - 本地使用说明

## 快速开始

### 一键启动（最简单）

双击运行 `启动.sh` 文件，或者在终端执行：

```bash
cd /Users/xiaoyan/Desktop/舆情/BettaFish-test
./启动.sh
```

这个脚本会自动：
1. 创建虚拟环境（首次运行）
2. 安装所有依赖（首次运行）
3. 启动Web界面

启动成功后，浏览器会自动打开 http://localhost:5000

---

## 系统功能

### 1. 统计概览
- 今日监测数量
- 未处理信息数量
- 负面信息数量
- 价格问题数量

### 2. 筛选功能（侧边栏）
- **平台筛选**: 全部、小红书、抖音、微博、B站
- **分类筛选**: 价格问题、商品问题、服务问题、会员问题、安全问题、其他问题
- **日期筛选**: 全部、今天、昨天、近7天、近30天
- **状态筛选**: 未处理、已处理、全部

### 3. 手动刷新功能 ⭐️ 新功能
点击页面顶部的 **"🔄 手动刷新全网数据"** 按钮：
- 立即触发全平台爬取
- 自动搜索小红书、抖音、微博、B站
- 爬取完成后会显示"✅ 已完成全网搜索！"
- 数据将在几分钟内更新到列表

### 4. 信息处理
每条信息都有以下操作：
- **📋 复制内容**: 复制完整内容（包括标题、正文、链接）
- **✅ 标记已处理**: 标记为已处理状态

---

## 停止服务

在终端按 `Ctrl + C` 即可停止服务

---

## 常见问题

### Q1: 启动失败，提示找不到 streamlit？

这是因为依赖还没安装。解决方法：

```bash
cd /Users/xiaoyan/Desktop/舆情/BettaFish-test
./启动.sh
```

脚本会自动安装所有依赖。

---

### Q2: 启动脚本双击无反应？

在终端手动执行：

```bash
cd /Users/xiaoyan/Desktop/舆情/BettaFish-test
chmod +x 启动.sh
./启动.sh
```

---

### Q3: 端口5000被占用？

方法1：修改端口
```bash
cd /Users/xiaoyan/Desktop/舆情/BettaFish-test
source venv/bin/activate
streamlit run baiguoyuan_review_app.py --server.port 5001
```

方法2：停止占用进程
```bash
# 查找占用5000端口的进程
lsof -i :5000

# 停止进程
kill -9 <PID>
```

---

### Q4: 手动刷新按钮不工作？

确保 MindSpider 爬虫系统已配置：

```bash
cd /Users/xiaoyan/Desktop/舆情/BettaFish-test/MindSpider

# 首次使用需要初始化数据库
python main.py --setup

# 测试爬虫（小红书需要扫码登录）
python main.py --deep-sentiment --platforms xhs --test
```

---

### Q5: 如何查看更多日志？

日志文件位置：
- 应用日志: `/Users/xiaoyan/Desktop/舆情/BettaFish-test/logs/`
- Streamlit日志: 终端输出

---

## 高级使用

### 手动运行爬虫

如果想在后台定时爬取数据：

```bash
cd /Users/xiaoyan/Desktop/舆情/BettaFish-test
python scheduler_daemon.py
```

这会启动定时任务，每天自动爬取3次（8:00、13:00、20:00）

停止：按 `Ctrl + C`

---

### 直接查看数据库

```bash
cd /Users/xiaoyan/Desktop/舆情/BettaFish-test
sqlite3 baiguoyuan_sentiment.db

# 在SQLite命令行中
.tables                          # 查看所有表
.schema sentiment_items          # 查看表结构
SELECT * FROM sentiment_items;   # 查看数据
.quit                            # 退出
```

---

### 修改监测关键词

编辑文件 `scheduler_daemon.py`，找到 `KEYWORDS` 列表：

```python
KEYWORDS = [
    "百果园&贵",
    "百果园&刺客",
    "百果园&吃不起",
    "百果园&2万元",
    "百果园&2万元吃不起",
    "百果园"
]
```

添加或修改关键词后，重启爬虫即可。

---

### 修改爬取平台

编辑文件 `scheduler_daemon.py`，找到 `PLATFORMS` 列表：

```python
PLATFORMS = ["xhs", "dy", "wb", "bili"]  # 小红书、抖音、微博、B站
```

可用平台代码：
- `xhs`: 小红书
- `dy`: 抖音
- `wb`: 微博
- `bili`: B站
- `ks`: 快手
- `tieba`: 百度贴吧
- `zhihu`: 知乎

---

## 系统要求

- **Python**: 3.8 或更高版本
- **操作系统**: macOS、Linux、Windows
- **浏览器**: Chrome、Firefox、Safari、Edge（任意现代浏览器）
- **内存**: 建议 2GB 以上
- **磁盘**: 建议 500MB 以上可用空间

---

## 目录结构

```
BettaFish-test/
├── 启动.sh                      # 一键启动脚本
├── 本地使用说明.md               # 本文档
├── 云端部署手册.md               # 云端部署指南
├── 云端部署.sh                  # 自动化部署脚本
├── baiguoyuan_review_app.py    # 主程序（审核界面）
├── scheduler_daemon.py         # 定时爬虫任务
├── baiguoyuan_sentiment.db     # 数据库文件
├── venv/                       # 虚拟环境（自动创建）
├── logs/                       # 日志目录（自动创建）
└── MindSpider/                 # 爬虫系统（如果存在）
```

---

## 技术支持

如遇问题，请按以下步骤排查：

1. **查看终端输出** - 大多数错误会显示在终端
2. **查看日志文件** - `logs/` 目录下的日志
3. **检查依赖安装** - 确保 `venv/` 目录存在且依赖已安装
4. **重启服务** - 停止后重新运行 `./启动.sh`

---

## 更新日志

### v1.1 (2025-11-06)
- ✨ 新增手动刷新全网数据功能
- 🚀 添加一键启动脚本
- 📝 完善使用文档

### v1.0 (2025-11-06)
- 🎉 初始版本发布
- 📊 实现人工审核界面
- 🔍 支持多平台舆情监测
- 🤖 集成DeepSeek AI分析

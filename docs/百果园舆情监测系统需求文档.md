# 百果园舆情监测系统 - 完整需求文档

**文档版本：** v1.0
**创建日期：** 2025-11-06
**项目代号：** BettaFish-Baiguoyuan
**目标用户：** 百果园公关/客服团队

---

## 📋 一、项目概述

### 1.1 项目背景
百果园需要一套舆情监测系统，实时监控全网关于"百果园"品牌的讨论，特别是价格相关的负面舆情（"贵"、"刺客"、"吃不起"等），以便及时响应和处理。

### 1.2 核心目标
- ✅ 全平台监测：小红书、抖音、微博、B站、微信公众号、头条号
- ✅ 关键词监测：百果园品牌相关，重点是价格KPI
- ✅ 自动分类：商品、价格、服务、资本市场、会员、安全等
- ✅ 人工审核：提供中文界面，方便复制和标记处理
- ✅ 定期报告：日报、周报、月报、季报、年报

### 1.3 使用场景
**7×16小时监测**（早8点-晚12点）：
- 每天定时爬取5次（8:00/12:00/16:00/20:00/23:00）
- 客服人员打开审核界面查看新信息
- 发现重要舆情，复制内容手动推送到工单系统
- 定期查看自动生成的报告

---

## 🎯 二、第一版需求（MVP）

### 2.1 监测平台（4个）
✅ **已支持（优先上线）：**
1. **小红书（xhs）**
2. **抖音（dy）**
3. **微博（wb）**
4. **B站（bili）** - 替代头条号

⚠️ **暂不支持（后续迭代）：**
- 微信公众号（需要新榜API，等账号申请下来）
- 视频号（同上）
- 头条号（需要单独开发爬虫）

### 2.2 关键词配置
**核心监测词：**
```python
KEYWORDS = [
    "百果园&贵",
    "百果园&刺客",
    "百果园&吃不起",
    "百果园&2万元",
    "百果园&2万元吃不起",
    "百果园"  # 泛监测
]
```

**分类标签（自动识别）：**
- **价格问题**：贵、刺客、吃不起、2万元、太贵、水果刺客
- **商品问题**：坏了、质量、不新鲜、烂了、发霉
- **服务问题**：态度、服务差、不耐烦、黑脸
- **会员问题**：会员卡、积分、充值、退款
- **安全问题**：食品安全、中毒、腹泻、投诉
- **其他问题**：未匹配到以上分类

### 2.3 定时爬取
**频率：** 每天5次
**时间点：**
- 08:00 - 早高峰
- 12:00 - 午休时段
- 16:00 - 下午茶
- 20:00 - 晚高峰
- 23:00 - 睡前总结

**实现方式：** cron定时任务或系统自带定时器

### 2.4 人工审核界面

#### 界面原型（中文）
```
┌─────────────────────────────────────────────────────────┐
│  百果园舆情监测系统 - 人工审核后台                         │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  筛选条件：                                               │
│  [分类: 全部▼] [平台: 全部▼] [日期: 今天▼] [状态: 未处理▼] [🔄刷新]  │
│                                                          │
│  统计概览：                                               │
│  今日监测：126条 | 未处理：45条 | 负面：23条 | 价格问题：18条  │
│                                                          │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  【1】📱 小红书 | ⏰ 11-06 10:23 | 🔥 热度：1.2万 | 状态：未处理 │
│  ├─ 关键词：百果园&贵                                      │
│  ├─ 标题：百果园真是水果刺客，太贵了买不起！                 │
│  ├─ 内容：今天去百果园买了一个苹果18块钱，一个榴莲要98，      │
│  │         真的是水果界的爱马仕，普通人根本吃不起...          │
│  ├─ 情感：😡 负面 (-0.85) | 分类：💰 价格问题               │
│  ├─ 链接：https://xiaohongshu.com/xxxxx                   │
│  └─ 操作：[📋 复制内容] [✅ 标记已处理]                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  【2】📹 抖音 | ⏰ 11-06 09:15 | 🔥 热度：5.6万 | 状态：未处理 │
│  ├─ 关键词：百果园&刺客                                    │
│  ├─ 标题：探店百果园，看看是不是真的是水果刺客！             │
│  ├─ 内容：今天带大家探店百果园，结账时被价格吓到了，         │
│  │         一共才买了3样水果就花了150块...                  │
│  ├─ 情感：😐 中性 (-0.12) | 分类：💰 价格问题               │
│  ├─ 链接：https://douyin.com/video/xxxxx                  │
│  └─ 操作：[📋 复制内容] [✅ 标记已处理]                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  【3】🐦 微博 | ⏰ 11-06 08:45 | 🔥 热度：8900 | 状态：未处理  │
│  ...                                                      │
│                                                          │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  [◀ 上一页]  第 1/5 页  [下一页 ▶]                        │
└─────────────────────────────────────────────────────────┘
```

#### 功能说明
**顶部筛选栏：**
- 分类筛选：全部/价格问题/商品问题/服务问题/会员问题/安全问题/其他
- 平台筛选：全部/小红书/抖音/微博/B站
- 日期筛选：今天/昨天/近7天/近30天/自定义日期
- **状态筛选：未处理/已处理/全部** ⭐ 新增
- 刷新按钮：手动刷新数据

**统计概览：**
- 今日监测总数
- 未处理数量（红色高亮）
- 负面信息数量
- 价格问题数量（KPI重点）

**信息列表：**
- 平台图标 + 名称
- 发布时间
- 热度/浏览量
- **处理状态**（未处理/已处理）⭐ 新增
- 关键词命中
- 标题和内容摘要
- 情感分析结果（正面/中性/负面 + 分数）
- 自动分类标签
- 原文链接

**操作按钮：**
- ✅ **[📋 复制内容]**：点击后自动复制标题+内容到剪贴板
- ✅ **[✅ 标记已处理]**：点击后状态变为"已处理"，该条信息不再显示在"未处理"筛选中
- ❌ ~~[推送工单]~~（删除，改为人工手动粘贴）

### 2.5 报告生成

#### 报告类型
1. **日报**：每天23:30自动生成
2. **周报**：每周一08:00自动生成
3. **月报**：每月1号08:00自动生成
4. **季报**：每季度首日08:00生成（手动或自动）
5. **年报**：每年1月1日08:00生成（手动或自动）

#### 报告内容结构
**百果园舆情监测报告**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 第一部分：舆情概览

1. 核心数据看板
   - 监测总量：X条
   - 负面信息：X条（占比X%）
   - 中性信息：X条
   - 正面信息：X条
   - 声量趋势图（折线图）

2. 价格KPI专项统计 ⭐ 重点
   - "百果园&贵"：X条
   - "百果园&刺客"：X条
   - "百果园&吃不起"：X条
   - "百果园&2万元"：X条
   - KPI趋势图（柱状图）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📈 第二部分：分类统计

1. 问题分类分布（饼图）
   - 价格问题：X条（X%）
   - 商品问题：X条（X%）
   - 服务问题：X条（X%）
   - 会员问题：X条（X%）
   - 安全问题：X条（X%）
   - 其他问题：X条（X%）

2. 平台分布（柱状图）
   - 小红书：X条
   - 抖音：X条
   - 微博：X条
   - B站：X条

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔥 第三部分：热点话题TOP 5

【话题1】百果园价格争议
- 声量：X条
- 情感：负面占X%
- 典型案例：
  "一个苹果18块钱，太贵了..."（小红书，1.2万赞）
- 传播趋势：持续发酵

【话题2】...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 第四部分：风险预警

1. 高风险信息（负面情感 < -0.7）
   - 案例1：...
   - 案例2：...

2. 传播风险（热度 > 5万）
   - 案例1：...

3. 舆情走势预判
   - AI分析：根据历史数据和当前趋势，预计...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 第五部分：建议

1. 公关建议
2. 产品建议
3. 下一周期关注重点

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 🤖 三、AI模型配置

### 3.1 第一版（MVP）- 纯DeepSeek
**目标：** 快速上线，控制成本

**配置：**
```python
# 所有AI任务都用DeepSeek
INSIGHT_ENGINE_MODEL = "deepseek-chat"
MEDIA_ENGINE_MODEL = "deepseek-chat"
QUERY_ENGINE_MODEL = "deepseek-chat"
REPORT_ENGINE_MODEL = "deepseek-chat"
SENTIMENT_ANALYSIS_MODEL = "deepseek-chat"
```

**成本：** 约10-20元/月

**优点：**
- 便宜（1元/百万tokens）
- 推理能力强
- 快速验证可行性

**缺点：**
- 上下文长度有限（32K）
- 多模态能力弱（不能分析图片视频）

---

### 3.2 第二版（优化） - 多模型组合 ⭐ 推荐
**目标：** 准确率更高，各取所长

#### 模型分工
| AI任务 | 推荐模型 | 原因 | 月成本 |
|--------|---------|------|--------|
| **情感分析** | 通义千问 Qwen-Plus | 中文理解好，电商场景优化 | 免费（100万/天） |
| **关键词提取** | DeepSeek | 推理能力强，便宜 | 10元 |
| **分类判断** | DeepSeek | 推理能力强 | 已包含 |
| **深度报告生成** | Kimi | 128K超长上下文 | 60元 |
| **舆情预警分析** | DeepSeek | 推理能力强 | 已包含 |
| **多模态分析** | Gemini 2.0 Flash | 免费，图片视频能力强 | 免费 |

**总成本：** 约70元/月

**配置：**
```python
# config.py
SENTIMENT_ANALYSIS_MODEL = "qwen-plus"  # 情感分析
INSIGHT_ENGINE_MODEL = "deepseek-chat"  # 关键词提取
QUERY_ENGINE_MODEL = "deepseek-chat"    # 分类判断
REPORT_ENGINE_MODEL = "moonshot-v1-128k"  # 报告生成
MEDIA_ENGINE_MODEL = "gemini-2.0-flash-exp"  # 多模态分析
```

#### API申请清单
| 模型 | 厂商 | 申请地址 | 备注 |
|------|------|---------|------|
| DeepSeek | 深度求索 | https://platform.deepseek.com/ | ✅ 你已有 |
| Kimi | 月之暗面 | https://platform.moonshot.cn/ | ⭐ 建议申请 |
| 通义千问 | 阿里云 | https://dashscope.aliyun.com/ | ⭐ 建议申请（免费） |
| Gemini | Google | https://aistudio.google.com/ | 可选（免费） |

---

### 3.3 第三版（企业级） - 准确性优先
**目标：** 舆情分析极致准确，不差钱

#### 模型分工
| AI任务 | 推荐模型 | 月成本 |
|--------|---------|--------|
| **情感分析** | GPT-4o | 200元 |
| **关键词提取** | Claude 3.5 Sonnet | 150元 |
| **分类判断** | Claude 3.5 Sonnet | 已包含 |
| **深度报告生成** | GPT-4o | 已包含 |
| **舆情预警分析** | o1-mini | 100元 |
| **多模态分析** | Gemini 2.5 Pro | 300元 |

**总成本：** 约750元/月

**适用场景：** 对准确率要求极高，预算充足

---

## 📱 四、平台登录说明

### 4.1 首次登录（扫码）
**需要：** 是的，每个平台首次部署需要扫码登录一次

**流程：**
1. 部署时运行爬虫脚本
2. 自动打开浏览器/显示二维码
3. 你用手机APP扫码登录
4. 登录成功后，系统保存Cookies

**时间：** 每个平台约2分钟，4个平台共10分钟

### 4.2 后续运行（自动）
✅ **登录一次后，后续不需要再扫码！**

**原理：**
- 系统保存登录状态（Cookies）到 `browser_data/` 目录
- 每次爬取自动加载Cookies，无需重新登录
- Cookies有效期通常3-6个月

### 4.3 什么时候需要重新扫码？
⚠️ 只有以下情况需要重新登录：
1. Cookies过期（3-6个月后）
2. 平台检测到异常，要求重新登录
3. 你在手机APP上退出登录了
4. 服务器重装/清空了 `browser_data/` 目录

**处理方式：**
- 我会设置监控，发现登录失效自动通知你
- 你重新扫码一次即可恢复

---

## 🔮 五、后续迭代计划

### 迭代1：微信公众号接入（优先级：高）
**前置条件：** 新榜API账号申请下来

**工作内容：**
1. 集成新榜API
2. 配置百果园相关公众号监测
3. 数据接入审核界面
4. 测试验证

**预计工时：** 2天

**成本增加：** 新榜API费用（5-15万/年企业版，或先试用2000 unit免费额度）

---

### 迭代2：头条号接入（优先级：中）
**技术方案：** 需要单独开发头条号爬虫

**工作内容：**
1. 研究头条号反爬机制
2. 开发爬虫模块（参考MediaCrawler架构）
3. 登录模块开发
4. 数据入库和展示
5. 测试验证

**预计工时：** 5-7天

**技术难度：** 中等（头条反爬比较严格）

---

### 迭代3：视频号接入（优先级：中）
**技术方案：**
- 方案A：等新榜支持视频号数据
- 方案B：通过微信公众平台API（需要视频号授权）

**工作内容：**
- 待方案确定后评估

**预计工时：** 待定

---

### 迭代4：工单系统API对接（优先级：低）
**前置条件：** 百果园提供工单系统API文档

**工作内容：**
1. 对接API接口
2. 审核界面增加"推送工单"按钮
3. 推送状态跟踪
4. 错误处理和重试

**预计工时：** 3天

---

### 迭代5：实时预警系统（优先级：高）
**目标：** 突发舆情立刻通知

**功能：**
1. 异常检测算法
   - 声量突然暴涨（3σ原则）
   - 负面情感激增
   - 关键词爆发
2. 多渠道推送
   - 企业微信消息
   - 短信通知
   - 邮件预警
3. 分级预警
   - 低风险：黄色预警
   - 中风险：橙色预警
   - 高风险：红色预警

**预计工时：** 5-7天

---

### 迭代6：移动端APP（优先级：低）
**目标：** 手机随时查看舆情

**功能：**
- 查看最新监测信息
- 接收预警推送
- 快速标记处理
- 查看报告

**技术方案：**
- Flutter开发（iOS + Android）
- 或微信小程序

**预计工时：** 15-20天

---

### 迭代7：AI能力增强（优先级：中）
**功能：**
1. **用户画像分析**
   - 年龄分布
   - 地域分布
   - 消费能力
2. **竞品对比**
   - 自动对比百果园 vs 鲜丰水果 vs 盒马
   - 价格对比
   - 口碑对比
3. **趋势预测**
   - 基于历史数据预测舆情走向
   - 时序模型（LSTM/Prophet）
4. **自动回复建议**
   - AI生成回复模板
   - 根据舆情类型推荐话术

**预计工时：** 10-15天

---

## 📊 六、技术架构

### 6.1 系统架构图
```
┌─────────────────────────────────────────────────────┐
│                    用户层                              │
│  [审核后台Web界面]  [报告查看]  [预警通知]              │
└──────────────────┬──────────────────────────────────┘
                   │
┌──────────────────▼──────────────────────────────────┐
│                  应用层                                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐           │
│  │Flask主应用│  │Streamlit│  │定时任务  │            │
│  │(审核界面)│  │(Agent UI)│  │调度器   │            │
│  └──────────┘  └──────────┘  └──────────┘           │
└──────────────────┬──────────────────────────────────┘
                   │
┌──────────────────▼──────────────────────────────────┐
│                  AI层                                 │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐           │
│  │情感分析  │  │关键词提取│  │报告生成  │            │
│  │(Qwen)    │  │(DeepSeek)│  │(Kimi)    │            │
│  └──────────┘  └──────────┘  └──────────┘           │
└──────────────────┬──────────────────────────────────┘
                   │
┌──────────────────▼──────────────────────────────────┐
│                数据采集层                              │
│  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐            │
│  │小红书 │  │抖音  │  │微博  │  │B站   │             │
│  │爬虫  │  │爬虫  │  │爬虫  │  │爬虫  │             │
│  └──────┘  └──────┘  └──────┘  └──────┘            │
└──────────────────┬──────────────────────────────────┘
                   │
┌──────────────────▼──────────────────────────────────┐
│                数据存储层                              │
│  ┌─────────────────┐  ┌─────────────────┐           │
│  │PostgreSQL数据库  │  │Redis缓存        │           │
│  │(历史数据)       │  │(实时数据)       │           │
│  └─────────────────┘  └─────────────────┘           │
└─────────────────────────────────────────────────────┘
```

### 6.2 技术栈
**后端：**
- Python 3.11
- Flask 2.3（Web框架）
- Streamlit 1.28（审核界面）
- Playwright 1.45（浏览器自动化）
- SQLAlchemy 2.0（ORM）
- APScheduler 3.10（定时任务）

**数据库：**
- PostgreSQL 15（主数据库）
- Redis 7.0（缓存）

**AI模型：**
- DeepSeek（关键词/分类）
- Kimi（报告生成）
- 通义千问（情感分析）

**前端：**
- Streamlit（快速开发，自带中文支持）
- Plotly（数据可视化）

**部署：**
- Docker（容器化）
- Ubuntu 22.04（操作系统）
- Nginx（反向代理，可选）

---

## 📅 七、开发计划

### 第一版（MVP）开发计划

#### Week 1：基础功能开发
**Day 1-2：爬虫系统改造**
- [ ] 配置4个平台关键词
- [ ] 设置定时任务（一天5次）
- [ ] 测试爬取功能

**Day 3-4：审核界面开发**
- [ ] 开发信息列表展示
- [ ] 实现筛选功能（分类/平台/日期/状态）
- [ ] 实现复制和标记功能
- [ ] 添加统计看板

**Day 5：AI分析集成**
- [ ] 接入DeepSeek API
- [ ] 实现情感分析
- [ ] 实现自动分类

#### Week 2：报告和部署
**Day 6-7：报告生成**
- [ ] 定制百果园报告模板
- [ ] 实现日报/周报/月报自动生成
- [ ] 测试报告功能

**Day 8-9：部署和测试**
- [ ] 云服务器部署
- [ ] 平台账号登录（扫码）
- [ ] 完整流程测试

**Day 10：文档和培训**
- [ ] 编写使用文档
- [ ] 录制操作视频
- [ ] 用户培训

---

## 📞 八、联系和支持

### 技术负责人
- 开发者：Claude Code
- 联系方式：[待补充]

### 项目交付物
1. ✅ 可运行的舆情监测系统
2. ✅ 中文审核界面
3. ✅ 自动报告生成功能
4. ✅ 详细使用文档
5. ✅ 操作视频教程
6. ✅ 云服务器部署（或本地部署）

### 后续支持
- 系统维护
- Bug修复
- 功能迭代
- 技术咨询

---

## 📝 九、变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| v1.0 | 2025-11-06 | 初始版本创建 | Claude Code |

---

**文档结束**
